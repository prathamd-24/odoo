-- 0) SQL modes for safety (optional at session level)
-- SET sql_mode = 'STRICT_ALL_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE';

-- 1) Security & Identity
CREATE TABLE roles (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) NOT NULL UNIQUE,        -- 'Admin','Project Manager','Team Member','Sales/Finance'
  description VARCHAR(255) NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(190) NOT NULL UNIQUE,
  full_name VARCHAR(120) NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  hourly_rate DECIMAL(10,2) NOT NULL DEFAULT 0.00, -- admin-set
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE user_roles (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  role_id INT NOT NULL,
  UNIQUE KEY uq_user_role (user_id, role_id),
  CONSTRAINT fk_user_roles_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT fk_user_roles_role FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 2) Master data
CREATE TABLE partners (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(160) NOT NULL,
  type ENUM('customer','vendor','both') NOT NULL DEFAULT 'customer',
  email VARCHAR(190) NULL,
  phone VARCHAR(40) NULL,
  tax_id VARCHAR(50) NULL,
  billing_address TEXT NULL,
  shipping_address TEXT NULL,
  UNIQUE KEY uq_partner_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE products (
  id INT AUTO_INCREMENT PRIMARY KEY,
  sku VARCHAR(60) NOT NULL UNIQUE,
  name VARCHAR(160) NOT NULL,
  description TEXT NULL,
  uom VARCHAR(30) NOT NULL DEFAULT 'unit',
  default_price DECIMAL(12,2) NOT NULL DEFAULT 0.00
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 3) Projects & Teaming
CREATE TABLE projects (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_code VARCHAR(40) NOT NULL UNIQUE,
  name VARCHAR(180) NOT NULL,
  description TEXT NULL,
  project_manager_id INT NULL,
  start_date DATE NULL,
  end_date DATE NULL,
  status ENUM('planned','in_progress','completed','on_hold','cancelled') NOT NULL DEFAULT 'planned',
  budget_amount DECIMAL(12,2) NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_projects_pm FOREIGN KEY (project_manager_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE project_members (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  role_in_project VARCHAR(80) NULL,
  added_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uq_project_user (project_id, user_id),
  KEY idx_project_members_user (user_id),
  CONSTRAINT fk_pm_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  CONSTRAINT fk_pm_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 4) Tasks & Collaboration
CREATE TABLE tasks (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  title VARCHAR(200) NOT NULL,
  description TEXT NULL,
  priority ENUM('low','medium','high','urgent') NOT NULL DEFAULT 'medium',
  state ENUM('new','in_progress','blocked','done') NOT NULL DEFAULT 'new',
  due_date DATE NULL,
  created_by INT NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_tasks_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  CONSTRAINT fk_tasks_creator FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
  KEY idx_tasks_project_state (project_id, state),
  KEY idx_tasks_due (due_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE task_assignments (
  id INT AUTO_INCREMENT PRIMARY KEY,
  task_id INT NOT NULL,
  user_id INT NOT NULL,
  assigned_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uq_task_user (task_id, user_id),
  KEY idx_task_assign_user (user_id),
  CONSTRAINT fk_ta_task FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,
  CONSTRAINT fk_ta_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE task_comments (
  id INT AUTO_INCREMENT PRIMARY KEY,
  task_id INT NOT NULL,
  user_id INT NULL,
  comment TEXT NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_tc_task FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,
  CONSTRAINT fk_tc_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
  KEY idx_task_comments_task (task_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE task_attachments (
  id INT AUTO_INCREMENT PRIMARY KEY,
  task_id INT NOT NULL,
  uploaded_by INT NULL,                           -- <-- made NULLABLE so SET NULL is valid
  file_name VARCHAR(255) NOT NULL,
  file_url VARCHAR(500) NOT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_tatt_task FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,
  CONSTRAINT fk_tatt_user FOREIGN KEY (uploaded_by) REFERENCES users(id) ON DELETE SET NULL,
  KEY idx_task_attachments_task (task_id),
  KEY idx_task_attachments_uploaded_by (uploaded_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 5) Sales Orders
CREATE TABLE sales_orders (
  id INT AUTO_INCREMENT PRIMARY KEY,
  so_number VARCHAR(40) NOT NULL UNIQUE,
  project_id INT NOT NULL,
  customer_id INT NOT NULL,
  order_date DATE NOT NULL,
  status ENUM('draft','confirmed','cancelled','closed') NOT NULL DEFAULT 'draft',
  currency VARCHAR(3) NOT NULL DEFAULT 'INR',
  notes TEXT NULL,
  CONSTRAINT fk_so_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_so_customer FOREIGN KEY (customer_id) REFERENCES partners(id) ON DELETE RESTRICT,
  KEY idx_so_project (project_id),
  KEY idx_so_customer (customer_id),
  KEY idx_so_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE sales_order_lines (
  id INT AUTO_INCREMENT PRIMARY KEY,
  sales_order_id INT NOT NULL,
  product_id INT NULL,
  description VARCHAR(255) NOT NULL,
  quantity DECIMAL(12,4) NOT NULL DEFAULT 1.0000,
  unit_price DECIMAL(12,2) NOT NULL,
  line_total DECIMAL(12,2) AS (quantity * unit_price) STORED,
  milestone_flag BOOLEAN NOT NULL DEFAULT FALSE,
  CONSTRAINT fk_sol_so FOREIGN KEY (sales_order_id) REFERENCES sales_orders(id) ON DELETE CASCADE,
  CONSTRAINT fk_sol_prod FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
  KEY idx_sol_so (sales_order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 6) Purchase Orders
CREATE TABLE purchase_orders (
  id INT AUTO_INCREMENT PRIMARY KEY,
  po_number VARCHAR(40) NOT NULL UNIQUE,
  project_id INT NOT NULL,
  vendor_id INT NOT NULL,
  order_date DATE NOT NULL,
  status ENUM('draft','confirmed','cancelled','closed') NOT NULL DEFAULT 'draft',
  currency VARCHAR(3) NOT NULL DEFAULT 'INR',
  notes TEXT NULL,
  CONSTRAINT fk_po_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_po_vendor FOREIGN KEY (vendor_id) REFERENCES partners(id) ON DELETE RESTRICT,
  KEY idx_po_project (project_id),
  KEY idx_po_vendor (vendor_id),
  KEY idx_po_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE purchase_order_lines (
  id INT AUTO_INCREMENT PRIMARY KEY,
  purchase_order_id INT NOT NULL,
  product_id INT NULL,
  description VARCHAR(255) NOT NULL,
  quantity DECIMAL(12,4) NOT NULL DEFAULT 1.0000,
  unit_cost DECIMAL(12,2) NOT NULL,
  line_total DECIMAL(12,2) AS (quantity * unit_cost) STORED,
  CONSTRAINT fk_pol_po FOREIGN KEY (purchase_order_id) REFERENCES purchase_orders(id) ON DELETE CASCADE,
  CONSTRAINT fk_pol_prod FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
  KEY idx_pol_po (purchase_order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 7) Customer Invoices
CREATE TABLE customer_invoices (
  id INT AUTO_INCREMENT PRIMARY KEY,
  invoice_number VARCHAR(40) NOT NULL UNIQUE,
  project_id INT NOT NULL,
  customer_id INT NOT NULL,
  invoice_date DATE NOT NULL,
  due_date DATE NULL,
  status ENUM('draft','posted','paid','void') NOT NULL DEFAULT 'draft',
  currency VARCHAR(3) NOT NULL DEFAULT 'INR',
  notes TEXT NULL,
  CONSTRAINT fk_ci_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_ci_customer FOREIGN KEY (customer_id) REFERENCES partners(id) ON DELETE RESTRICT,
  KEY idx_ci_project (project_id),
  KEY idx_ci_customer (customer_id),
  KEY idx_ci_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE customer_invoice_lines (
  id INT AUTO_INCREMENT PRIMARY KEY,
  customer_invoice_id INT NOT NULL,
  product_id INT NULL,
  description VARCHAR(255) NOT NULL,
  quantity DECIMAL(12,4) NOT NULL DEFAULT 1.0000,
  unit_price DECIMAL(12,2) NOT NULL,
  line_total DECIMAL(12,2) AS (quantity * unit_price) STORED,
  -- Optional lineage for analytics/link-back:
  sales_order_line_id INT NULL,
  source_type ENUM('timesheet','expense','manual','sales_order') NOT NULL DEFAULT 'manual',
  source_id INT NULL,
  CONSTRAINT fk_cil_ci FOREIGN KEY (customer_invoice_id) REFERENCES customer_invoices(id) ON DELETE CASCADE,
  CONSTRAINT fk_cil_prod FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
  CONSTRAINT fk_cil_sol FOREIGN KEY (sales_order_line_id) REFERENCES sales_order_lines(id) ON DELETE SET NULL,
  -- Note: source_id is a soft reference (polymorphic); enforce app-side.
  KEY idx_cil_ci (customer_invoice_id),
  KEY idx_cil_source (source_type, source_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 8) Vendor Bills
CREATE TABLE vendor_bills (
  id INT AUTO_INCREMENT PRIMARY KEY,
  bill_number VARCHAR(40) NOT NULL UNIQUE,
  project_id INT NOT NULL,
  vendor_id INT NOT NULL,
  bill_date DATE NOT NULL,
  due_date DATE NULL,
  status ENUM('draft','posted','paid','void') NOT NULL DEFAULT 'draft',
  currency VARCHAR(3) NOT NULL DEFAULT 'INR',
  notes TEXT NULL,
  CONSTRAINT fk_vb_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_vb_vendor FOREIGN KEY (vendor_id) REFERENCES partners(id) ON DELETE RESTRICT,
  KEY idx_vb_project (project_id),
  KEY idx_vb_vendor (vendor_id),
  KEY idx_vb_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE vendor_bill_lines (
  id INT AUTO_INCREMENT PRIMARY KEY,
  vendor_bill_id INT NOT NULL,
  product_id INT NULL,
  description VARCHAR(255) NOT NULL,
  quantity DECIMAL(12,4) NOT NULL DEFAULT 1.0000,
  unit_cost DECIMAL(12,2) NOT NULL,
  line_total DECIMAL(12,2) AS (quantity * unit_cost) STORED,
  purchase_order_line_id INT NULL,
  CONSTRAINT fk_vbl_vb FOREIGN KEY (vendor_bill_id) REFERENCES vendor_bills(id) ON DELETE CASCADE,
  CONSTRAINT fk_vbl_prod FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
  CONSTRAINT fk_vbl_pol FOREIGN KEY (purchase_order_line_id) REFERENCES purchase_order_lines(id) ON DELETE SET NULL,
  KEY idx_vbl_vb (vendor_bill_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 9) Expenses
CREATE TABLE expenses (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  task_id INT NULL,
  submitted_by INT NOT NULL,
  approved_by INT NULL,
  expense_date DATE NOT NULL,
  description VARCHAR(255) NOT NULL,
  amount DECIMAL(12,2) NOT NULL,
  billable BOOLEAN NOT NULL DEFAULT FALSE,
  status ENUM('submitted','approved','rejected','reimbursed') NOT NULL DEFAULT 'submitted',
  receipt_url VARCHAR(500) NULL,
  linked_invoice_line_id INT NULL, -- if billed to customer
  CONSTRAINT fk_exp_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_exp_task FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE SET NULL,
  CONSTRAINT fk_exp_submitter FOREIGN KEY (submitted_by) REFERENCES users(id) ON DELETE RESTRICT,
  CONSTRAINT fk_exp_approver FOREIGN KEY (approved_by) REFERENCES users(id) ON DELETE SET NULL,
  CONSTRAINT fk_exp_invoice_line FOREIGN KEY (linked_invoice_line_id) REFERENCES customer_invoice_lines(id) ON DELETE SET NULL,
  KEY idx_exp_project (project_id),
  KEY idx_exp_task (task_id),
  KEY idx_exp_status (status),
  KEY idx_exp_billable (billable)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 10) Timesheets
CREATE TABLE timesheets (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  task_id INT NOT NULL,
  user_id INT NOT NULL,
  work_date DATE NOT NULL,
  hours DECIMAL(5,2) NOT NULL CHECK (hours > 0),
  billable BOOLEAN NOT NULL DEFAULT TRUE,
  internal_cost_rate DECIMAL(10,2) NOT NULL, -- copy of user's hourly_rate at entry time
  cost_amount DECIMAL(12,2) AS (hours * internal_cost_rate) STORED,
  status ENUM('logged','approved','rejected','billed') NOT NULL DEFAULT 'logged',
  linked_invoice_line_id INT NULL, -- if billed to customer
  notes VARCHAR(255) NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_ts_project FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE RESTRICT,
  CONSTRAINT fk_ts_task FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,
  CONSTRAINT fk_ts_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT,
  CONSTRAINT fk_ts_invoice_line FOREIGN KEY (linked_invoice_line_id) REFERENCES customer_invoice_lines(id) ON DELETE SET NULL,
  UNIQUE KEY uq_ts_unique (task_id, user_id, work_date, hours, billable),
  KEY idx_ts_project (project_id),
  KEY idx_ts_user_date (user_id, work_date),
  KEY idx_ts_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 11) Helpful views (optional; not asked, but useful)
-- CREATE VIEW project_financials AS ... (omitted as per spec focuses on tables)

START TRANSACTION;

-- 1Ô∏è‚É£ Roles
INSERT INTO roles (name, description) VALUES
 ('Admin','Full access'),
 ('Project Manager','Manage projects, tasks, and billing'),
 ('Team Member','Execute tasks, log time, submit expenses'),
 ('Sales/Finance','Handle sales, purchases, invoices, and bills');

-- 2Ô∏è‚É£ Users
INSERT INTO users (email, full_name, password_hash, hourly_rate) VALUES
 ('pm@acme.com','Priya Manager','hash$pm',1500.00),
 ('dev1@acme.com','Arun Dev','hash$dev1',900.00),
 ('dev2@acme.com','Neha Dev','hash$dev2',1000.00),
 ('fin@acme.com','Sameer Finance','hash$fin',0.00);

-- 3Ô∏è‚É£ User Roles (many-to-many)
INSERT INTO user_roles (user_id, role_id) VALUES
 (1,1), -- Priya = Admin
 (1,2), -- Priya = Project Manager
 (2,3), -- Arun = Team Member
 (3,3), -- Neha = Team Member
 (4,4); -- Sameer = Sales/Finance

-- 4Ô∏è‚É£ Partners (customers & vendors)
INSERT INTO partners (name, type, email, phone) VALUES
 ('BrandCo Pvt Ltd','customer','ops@brandco.com','+91-99999-11111'),
 ('Pixel Photographers','vendor','hello@pixel.com','+91-88888-22222'),
 ('Tech Supplies','vendor','sales@techsupplies.com','+91-77777-33333'),
 ('Globex Corp','customer','it@globex.com','+91-66666-44444');

-- 5Ô∏è‚É£ Products
INSERT INTO products (sku, name, description, uom, default_price) VALUES
 ('WEB-BRND','Brand Website','Fixed-price website project','unit',100000.00),
 ('PHOTO-SHOOT','Photography','On-site photography day','day',12000.00),
 ('DEV-HOUR','Development Hour','Billable engineering hour','hour',1500.00),
 ('TRAVEL','Travel Expense','Travel / lodging','unit',0.00);

-- 6Ô∏è‚É£ Projects
INSERT INTO projects (project_code, name, description, project_manager_id, start_date, status, budget_amount) VALUES
 ('PRJ-0001','Brand Website','Website for BrandCo',1,'2025-11-01','in_progress',120000.00),
 ('PRJ-0002','Mobile App','MVP for Globex',1,'2025-10-15','planned',500000.00),
 ('PRJ-0003','Internal Tooling','DevOps automation',1,'2025-09-01','on_hold',200000.00);

-- 7Ô∏è‚É£ Project Members
INSERT INTO project_members (project_id, user_id, role_in_project) VALUES
 (1,1,'Project Manager'),
 (1,2,'Developer'),
 (1,3,'Developer'),
 (2,1,'Project Manager'),
 (2,3,'Developer');

-- 8Ô∏è‚É£ Tasks
INSERT INTO tasks (project_id, title, description, priority, state, due_date, created_by) VALUES
 (1,'Design','UI/UX for homepage','high','in_progress','2025-11-10',1),
 (1,'Build','Implement frontend + backend','high','new','2025-11-25',1),
 (1,'Photography','On-site brand shoot','medium','blocked','2025-11-12',1),
 (2,'Scope','Define MVP scope','medium','new','2025-11-20',1);

-- 9Ô∏è‚É£ Task Assignments
INSERT INTO task_assignments (task_id, user_id) VALUES
 (1,2),(2,2),(2,3),(3,3),(4,3);

-- üîü Task Comments
INSERT INTO task_comments (task_id, user_id, comment) VALUES
 (1,2,'Starting wireframes'),
 (1,1,'Please align with branding guide'),
 (3,3,'Waiting for vendor confirmation');

-- 1Ô∏è‚É£1Ô∏è‚É£ Task Attachments (‚úÖ uses uploaded_by INT NULL)
INSERT INTO task_attachments (task_id, uploaded_by, file_name, file_url) VALUES
 (1,2,'wireframe.png','https://files.acme/wireframe.png'),
 (1,1,'brand_guide.pdf','https://files.acme/brand_guide.pdf');

-- 1Ô∏è‚É£2Ô∏è‚É£ Sales Orders
INSERT INTO sales_orders (so_number, project_id, customer_id, order_date, status, currency, notes) VALUES
 ('SO-1001',1,1,'2025-11-01','confirmed','INR','Brand Website fixed price 100k'),
 ('SO-1002',2,4,'2025-10-16','draft','INR','MVP T&M'),
 ('SO-1003',3,1,'2025-09-05','cancelled','INR','Internal, later billed');

-- 1Ô∏è‚É£3Ô∏è‚É£ Sales Order Lines
INSERT INTO sales_order_lines (sales_order_id, product_id, description, quantity, unit_price, milestone_flag) VALUES
 (1,1,'Brand Website - Design milestone',1,40000.00,TRUE),
 (1,1,'Brand Website - Build milestone',1,60000.00,TRUE),
 (2,3,'Development hours package',100,1500.00,FALSE);

-- 1Ô∏è‚É£4Ô∏è‚É£ Purchase Orders
INSERT INTO purchase_orders (po_number, project_id, vendor_id, order_date, status, currency, notes) VALUES
 ('PO-2001',1,2,'2025-11-05','confirmed','INR','Photography day'),
 ('PO-2002',1,3,'2025-11-06','draft','INR','Hosting & tools'),
 ('PO-2003',2,3,'2025-10-20','confirmed','INR','Cloud credits');

-- 1Ô∏è‚É£5Ô∏è‚É£ Purchase Order Lines
INSERT INTO purchase_order_lines (purchase_order_id, product_id, description, quantity, unit_cost) VALUES
 (1,2,'Photography services',1,12000.00),
 (2,NULL,'Hosting for 1 month',1,3000.00),
 (3,NULL,'Cloud credits',1,20000.00);

-- 1Ô∏è‚É£6Ô∏è‚É£ Customer Invoices
INSERT INTO customer_invoices (invoice_number, project_id, customer_id, invoice_date, due_date, status, currency, notes) VALUES
 ('INV-3001',1,1,'2025-11-08','2025-11-22','posted','INR','Design milestone'),
 ('INV-3002',1,1,'2025-11-25','2025-12-09','draft','INR','Build milestone'),
 ('INV-3003',2,4,'2025-11-07','2025-11-21','draft','INR','T&M billing');

-- 1Ô∏è‚É£7Ô∏è‚É£ Customer Invoice Lines
INSERT INTO customer_invoice_lines (customer_invoice_id, product_id, description, quantity, unit_price, sales_order_line_id, source_type, source_id) VALUES
 (1,1,'Design milestone',1,40000.00,1,'sales_order',1),
 (2,1,'Build milestone',1,60000.00,2,'sales_order',2),
 (3,3,'Development hours - Nov wk1',20,1500.00,3,'timesheet',NULL);

-- 1Ô∏è‚É£8Ô∏è‚É£ Vendor Bills
INSERT INTO vendor_bills (bill_number, project_id, vendor_id, bill_date, due_date, status, currency, notes) VALUES
 ('BILL-4001',1,2,'2025-11-12','2025-11-26','posted','INR','Photography bill'),
 ('BILL-4002',1,3,'2025-11-10','2025-11-24','draft','INR','Hosting');

-- 1Ô∏è‚É£9Ô∏è‚É£ Vendor Bill Lines
INSERT INTO vendor_bill_lines (vendor_bill_id, product_id, description, quantity, unit_cost, purchase_order_line_id) VALUES
 (1,2,'Photography services',1,12000.00,1),
 (2,NULL,'Hosting for 1 month',1,3000.00,2);

-- 2Ô∏è‚É£0Ô∏è‚É£ Expenses
INSERT INTO expenses (project_id, task_id, submitted_by, approved_by, expense_date, description, amount, billable, status, receipt_url) VALUES
 (1,2,2,1,'2025-11-06','Travel to client',1500.00,TRUE,'approved','https://files.acme/receipts/travel1500.jpg'),
 (1,2,3,1,'2025-11-07','Snacks for team',300.00,FALSE,'approved','https://files/acme/receipts/snacks300.jpg'),
 (2,4,3,NULL,'2025-11-07','Taxi to workshop',800.00,TRUE,'submitted',NULL),
 (1,1,2,1,'2025-11-08','Stock photo license',500.00,TRUE,'approved',NULL);

-- 2Ô∏è‚É£1Ô∏è‚É£ Timesheets
INSERT INTO timesheets (project_id, task_id, user_id, work_date, hours, billable, internal_cost_rate, status, notes) VALUES
 (1,1,2,'2025-11-06',6.0,TRUE,900.00,'approved','Wireframes'),
 (1,1,3,'2025-11-07',5.5,TRUE,1000.00,'approved','Mockups'),
 (1,2,2,'2025-11-08',4.0,TRUE,900.00,'logged','API scaffolding'),
 (2,4,3,'2025-11-07',3.0,TRUE,1000.00,'approved','Scope meeting');

COMMIT;
